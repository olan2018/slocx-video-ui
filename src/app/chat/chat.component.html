<div class="meet-root">
  <!-- Top bar -->
  <div class="meet-topbar">
    <div class="meet-topbar-left">
      <img src="../../assets/slocx.png" class="meet-logo" alt="Slocx" />
      <span class="meet-brand">Slocx Classroom</span>
    </div>
    <div class="meet-topbar-right">
      <span class="meet-clock">{{ currentTime | date:'HH:mm' }}</span>
    </div>
  </div>

  <!-- Main area -->
  <div class="meet-main">
    <!-- Permission denied -->
    <div class="meet-state" *ngIf="permissionError">
      <div class="meet-state-icon meet-state-icon--error">
        <i class="bi bi-camera-video-off-fill"></i>
      </div>
      <p class="meet-state-title">Camera or microphone access denied</p>
      <p class="meet-state-sub">Please allow camera and microphone access in your browser settings, then refresh the page.</p>
    </div>

    <!-- Connection / room error -->
    <div class="meet-state" *ngIf="connectionError && !permissionError">
      <div class="meet-state-icon meet-state-icon--error">
        <i class="bi bi-wifi-off"></i>
      </div>
      <p class="meet-state-title">Unable to join classroom</p>
      <p class="meet-state-sub">{{ connectionErrorMsg }}</p>
    </div>

    <!-- Waiting for others -->
    <div class="meet-state" *ngIf="!permissionError && !connectionError && remoteCount === 0">
      <div class="meet-state-icon">
        <i class="bi bi-person-circle"></i>
      </div>
      <p class="meet-state-title">You're the only one here</p>
      <p class="meet-state-sub">Waiting for others to join the lesson...</p>
    </div>

    <!-- Remote video grid -->
    <div class="meet-video-grid" #videos [class.has-remotes]="remoteCount > 0"></div>

    <!-- Local video PiP -->
    <div class="meet-pip" *ngIf="!permissionError">
      <video #localVideo autoplay muted playsinline></video>
      <div class="meet-pip-overlay">
        <span class="meet-name-tag">You</span>
        <div class="meet-pip-badges">
          <i class="bi bi-mic-mute-fill" *ngIf="isMuted" style="color:#ea4335"></i>
          <i class="bi bi-camera-video-off-fill" *ngIf="!isCameraOn" style="color:#ea4335; margin-left:4px"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom control bar -->
  <div class="meet-controls">
    <div class="meet-controls-inner">
      <!-- Mic -->
      <button
        class="meet-ctrl-btn"
        [class.meet-ctrl-off]="isMuted"
        (click)="toggleMic()"
        [title]="isMuted ? 'Unmute microphone' : 'Mute microphone'"
      >
        <i class="bi" [class.bi-mic-fill]="!isMuted" [class.bi-mic-mute-fill]="isMuted"></i>
        <span class="meet-ctrl-label">{{ isMuted ? 'Unmute' : 'Mute' }}</span>
      </button>

      <!-- Camera -->
      <button
        class="meet-ctrl-btn"
        [class.meet-ctrl-off]="!isCameraOn"
        (click)="toggleCamera()"
        [title]="isCameraOn ? 'Turn off camera' : 'Turn on camera'"
      >
        <i class="bi" [class.bi-camera-video-fill]="isCameraOn" [class.bi-camera-video-off-fill]="!isCameraOn"></i>
        <span class="meet-ctrl-label">{{ isCameraOn ? 'Stop video' : 'Start video' }}</span>
      </button>

      <!-- Leave -->
      <button class="meet-ctrl-btn meet-ctrl-leave" (click)="leaveCall()" title="Leave call">
        <i class="bi bi-telephone-x-fill"></i>
        <span class="meet-ctrl-label">Leave</span>
      </button>
    </div>
  </div>
</div>
